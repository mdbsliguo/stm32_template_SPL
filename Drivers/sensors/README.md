# 传感器/外设芯片模块

## DS3231实时时钟模块 (ds3231)

### 功能列表

| 功能分类 | 函数 | 说明 |
|---------|------|------|
| **初始化** | `DS3231_Init()` | 初始化DS3231（支持硬件/软件I2C） |
| **初始化** | `DS3231_Deinit()` | 反初始化DS3231 |
| **初始化** | `DS3231_IsInitialized()` | 检查是否已初始化 |
| **时间管理** | `DS3231_ReadTime()` | 读取当前时间 |
| **时间管理** | `DS3231_SetTime()` | 设置时间 |
| **温度读取** | `DS3231_ReadTemperature()` | 读取温度（整数，0.25°C精度） |
| **温度读取** | `DS3231_ReadTemperatureFloat()` | 读取温度（浮点数） |
| **振荡器控制** | `DS3231_CheckOSF()` | 检查振荡器停止标志 |
| **振荡器控制** | `DS3231_ClearOSF()` | 清除振荡器停止标志 |
| **振荡器控制** | `DS3231_IsRunning()` | 检查是否正在运行 |
| **振荡器控制** | `DS3231_Start()` / `DS3231_Stop()` | 启动/停止RTC |
| **闹钟功能** | `DS3231_SetAlarm1()` / `DS3231_SetAlarm2()` | 设置闹钟1/2 |
| **闹钟功能** | `DS3231_ReadAlarm1()` / `DS3231_ReadAlarm2()` | 读取闹钟1/2 |
| **闹钟功能** | `DS3231_CheckAlarm1Flag()` / `DS3231_CheckAlarm2Flag()` | 检查闹钟标志 |
| **闹钟功能** | `DS3231_ClearAlarm1Flag()` / `DS3231_ClearAlarm2Flag()` | 清除闹钟标志 |
| **闹钟功能** | `DS3231_EnableAlarm1()` / `DS3231_DisableAlarm1()` | 使能/禁用闹钟1 |
| **闹钟功能** | `DS3231_EnableAlarm2()` / `DS3231_DisableAlarm2()` | 使能/禁用闹钟2 |
| **方波输出** | `DS3231_SetSquareWave()` | 设置方波输出频率和使能 |
| **方波输出** | `DS3231_DisableSquareWave()` | 禁用方波输出 |
| **方波输出** | `DS3231_EnableBatteryBackupSQW()` | 使能电池备份方波输出 |
| **32kHz输出** | `DS3231_Enable32kHz()` / `DS3231_Disable32kHz()` | 使能/禁用32kHz输出 |
| **32kHz输出** | `DS3231_Is32kHzEnabled()` | 检查32kHz输出状态 |
| **温度转换** | `DS3231_TriggerTemperatureConversion()` | 触发温度转换 |
| **温度转换** | `DS3231_IsTemperatureBusy()` | 检查温度转换忙标志 |
| **中断控制** | `DS3231_SetInterruptMode()` / `DS3231_GetInterruptMode()` | 设置/获取中断模式 |
| **老化偏移** | `DS3231_ReadAgingOffset()` / `DS3231_SetAgingOffset()` | 读取/设置老化偏移 |
| **寄存器访问** | `DS3231_ReadControlRegister()` / `DS3231_WriteControlRegister()` | 读取/写入控制寄存器 |
| **寄存器访问** | `DS3231_ReadStatusRegister()` / `DS3231_WriteStatusRegister()` | 读取/写入状态寄存器 |

### 重要提醒

1. **I2C接口选择**：支持硬件I2C和软件I2C两种接口，通过配置结构体选择
2. **接口依赖**：使用硬件I2C前必须先包含`i2c_hw.h`，使用软件I2C前必须先包含`i2c_sw.h`
3. **初始化顺序**：必须先初始化对应的I2C模块（硬件I2C或软件I2C），再初始化DS3231
4. **I2C地址**：DS3231的I2C地址为0x68（7位地址）
5. **时间格式**：24小时制，年份范围2000-2099
6. **温度精度**：温度读取精度0.25°C，转换需要约1秒
7. **振荡器停止**：OSF标志为1表示RTC可能丢失时间，需要重新设置时间
8. **闹钟模式**：支持多种匹配模式（每秒、秒匹配、分秒匹配等）
9. **方波频率**：支持1Hz、1.024kHz、4.096kHz、8.192kHz四种频率
10. **中断模式**：支持方波输出模式和闹钟中断模式

---

## MAX31856热电偶温度传感器模块 (max31856)

### 功能列表

| 功能分类 | 函数 | 说明 |
|---------|------|------|
| **初始化** | `MAX31856_Init()` | 初始化MAX31856（支持硬件/软件SPI） |
| **初始化** | `MAX31856_Deinit()` | 反初始化MAX31856 |
| **初始化** | `MAX31856_IsInitialized()` | 检查是否已初始化 |
| **配置** | `MAX31856_SetThermocoupleType()` | 设置热电偶类型（K、J、N、R、S、T、E、B型） |
| **配置** | `MAX31856_GetThermocoupleType()` | 获取热电偶类型 |
| **配置** | `MAX31856_SetAvgMode()` | 设置采样模式（1/2/4/8/16次采样） |
| **配置** | `MAX31856_GetAvgMode()` | 获取采样模式 |
| **配置** | `MAX31856_SetOCFault()` | 设置过温故障阈值（0/1/2/3°C） |
| **配置** | `MAX31856_SetFaultMode()` | 设置故障模式（比较器/中断） |
| **配置** | `MAX31856_SetCJSource()` | 设置冷端温度源（内部/外部） |
| **配置** | `MAX31856_SetConvMode()` | 设置转换模式（连续/单次） |
| **配置** | `MAX31856_ReadCR0()` | 读取控制寄存器0（CR0） |
| **配置** | `MAX31856_ReadCR1()` | 读取控制寄存器1（CR1） |
| **温度读取** | `MAX31856_ReadThermocoupleTemperature()` | 读取热电偶温度（摄氏度） |
| **温度读取** | `MAX31856_ReadColdJunctionTemperature()` | 读取冷端温度（摄氏度） |
| **故障检测** | `MAX31856_ReadFault()` | 读取故障状态（位掩码） |
| **故障检测** | `MAX31856_CheckFault()` | 检查特定故障 |
| **故障检测** | `MAX31856_ClearFault()` | 清除故障状态 |
| **故障屏蔽** | `MAX31856_SetFaultMask()` | 设置故障屏蔽 |
| **故障屏蔽** | `MAX31856_GetFaultMask()` | 获取故障屏蔽 |
| **转换控制** | `MAX31856_TriggerOneShot()` | 触发单次转换 |
| **转换控制** | `MAX31856_IsConversionReady()` | 检查转换完成状态 |

### 重要提醒

1. **SPI接口选择**：支持硬件SPI和软件SPI两种接口，通过配置结构体选择
2. **接口依赖**：使用硬件SPI前必须先包含`spi_hw.h`，使用软件SPI前必须先包含`spi_sw.h`
3. **初始化顺序**：必须先初始化对应的SPI模块（硬件SPI或软件SPI），再初始化MAX31856
4. **CS引脚**：需要手动配置CS引脚，驱动会自动控制CS引脚电平
5. **SPI模式**：MAX31856使用SPI模式1（CPOL=0, CPHA=1）或模式3（CPOL=1, CPHA=1）
6. **热电偶类型**：支持B、E、J、K、N、R、S、T型热电偶，初始化后需要设置热电偶类型
7. **温度精度**：热电偶温度精度0.0078125°C，冷端温度精度0.0625°C
8. **采样模式**：支持1/2/4/8/16次采样平均，采样次数越多精度越高但转换时间越长
9. **故障检测**：支持多种故障检测（开路、过温、欠温、过压/欠压等）
10. **转换模式**：支持连续转换和单次转换模式，单次转换模式需要等待转换完成
11. **过温故障阈值**：可配置过温故障阈值（0/1/2/3°C），用于故障检测
12. **故障模式**：支持比较器模式和中断模式两种故障检测模式
13. **冷端温度源**：支持内部冷端温度或外部冷端温度选择
14. **寄存器访问**：提供直接读取CR0/CR1控制寄存器的接口，便于高级配置

