# Drivers - 驱动层

驱动层，封装STM32标准外设库（SPL），提供统一的驱动接口，支持错误处理和自动时钟管理。

---

## 📋 模块分类清单

| 分类 | 说明 | 状态 |
|------|------|------|
| [基础外设](basic/) | GPIO、LED驱动 | ✅ 已实现 |
| [I2C通信](i2c/) | 硬件I2C、软件I2C驱动 | ✅ 已实现 |
| [SPI通信](spi/) | 硬件SPI、软件SPI驱动 | ✅ 已实现 |
| [显示驱动](display/) | OLED显示驱动（SSD1306） | ✅ 已实现 |
| [传感器/外设芯片](sensors/) | DS3231实时时钟驱动 | ✅ 已实现 |
| [串口通信](uart/) | UART驱动 | ✅ 已实现 |
| [CAN总线](can/) | CAN总线驱动 | ✅ 已实现 |
| [定时器](timer/) | 定时器驱动（PWM、输入捕获、编码器、输出比较） | ✅ 已实现（PWM、输入捕获、编码器、输出比较） |
| [模拟外设](analog/) | ADC、DAC驱动 | ✅ 已实现（ADC、DAC） |
| [DMA传输](dma/) | DMA驱动 | ✅ 已实现 |
| [系统外设](peripheral/) | EXTI、NVIC、RTC、WWDG、BKP、PWR、FLASH、CRC、DBGMCU、SDIO、FSMC、CEC驱动 | ✅ 已实现（EXTI、NVIC、RTC、WWDG、BKP、PWR、FLASH、CRC、DBGMCU、SDIO、FSMC、CEC） |
| [USB设备](usb/) | USB 2.0全速设备接口 | ✅ 基础框架（需扩展协议栈） |

---

## 🎯 职责

1. **SPL库封装**：封装STM32标准外设库函数，提供统一的驱动接口，自动管理外设时钟
2. **错误处理**：参数校验，错误码返回，错误日志记录
3. **功能增强**：配置表驱动，多实例支持，回调机制

---

## 🔧 驱动开发规范

1. **函数命名**：`模块名_功能名()`，如 `GPIO_Config()`、`LED_On()`、`UART_Send()`
2. **错误处理**：所有公共函数必须返回错误码（`error_code_t`），进行参数校验
3. **自动时钟管理**：驱动函数应自动使能外设时钟
4. **配置表驱动**：使用配置表而非硬编码，配置表在 `BSP/board.h` 中定义

---

## ⚠️ 重要说明

1. **不要直接调用SPL库函数**
   - ❌ 错误：`GPIO_Init()`（直接调用SPL）
   - ✅ 正确：`GPIO_Config()`（使用封装函数）

2. **保持接口一致性**
   - 所有驱动模块使用相同的错误处理方式
   - 函数命名遵循统一规范

3. **参数校验**
   - 所有公共函数都要进行参数校验
   - 返回明确的错误码

4. **线程安全**
   - 注意多任务环境下的资源保护
   - 使用临界区保护共享资源（如需要）

---

## 📚 详细文档

- **使用示例**：[Examples/](../Examples/) - 演示案例
- **各分类详细说明**：请查看各分类目录下的 `README.md`

---

## 🔗 相关模块

- **硬件配置**：`BSP/board.h` - 硬件配置表
- **错误处理**：`Common/error_handler.c/h` - 统一错误处理
- **系统服务**：`System/system_init.c/h` - 系统初始化

---

**最后更新**：2024-01-01
