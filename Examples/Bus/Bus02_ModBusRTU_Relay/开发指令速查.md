# 汇控电子数字量IO模块（RS485版）单片机开发核心指令速查

## 一、默认通信参数

- **地址**：1
- **波特率**：38400bps
- **数据格式**：8位数据位，1位停止位，无校验

------

## 二、Modbus寄存器功能速查

### 📤 **输出控制（线圈/保持寄存器）**

| 协议地址 | PLC地址 | 功能                             |
| :------- | :------ | :------------------------------- |
| `0000H`  | 00001   | 通道1输出控制（写1=ON，写0=OFF） |
| `0001H`  | 00002   | 通道2输出控制                    |
| `002FH`  | 00048   | 通道48输出控制                   |
| `0034H`  | 40053   | 批量控制（0=全关，1=全开）       |
| `0035H`  | 40054   | 批量控制通道1~16（按位）         |
| `0036H`  | 40055   | 批量控制通道17~32（按位）        |
| `0037H`  | 40056   | 批量控制通道33~48（按位）        |

### 📥 **输入状态（输入寄存器）**

| 协议地址 | PLC地址 | 功能                              |
| :------- | :------ | :-------------------------------- |
| `0000H`  | 30001   | 通道1输入状态（1=触发，0=未触发） |
| `0001H`  | 30002   | 通道2输入状态                     |
| `002FH`  | 30048   | 通道48输入状态                    |
| `0032H`  | 30051   | 通道1~16状态（按位，低bit=通道1） |
| `0033H`  | 30052   | 通道17~32状态（按位）             |
| `0034H`  | 30053   | 通道33~48状态（按位）             |

### ⚙️ **参数设置（保持寄存器）**

| 协议地址 | PLC地址 | 功能          | 默认值 | 说明                                                         |
| :------- | :------ | :------------ | :----- | :----------------------------------------------------------- |
| `0032H`  | 40051   | RS485地址     | 1      | 范围1~255，掉电保存                                          |
| `0033H`  | 40052   | 波特率        | 4      | 0=4800,1=9600,2=14400,3=19200,**4=38400**,5=56000,6=57600,7=115200 |
| `0096H`  | 40151   | 通道1工作模式 | 0      | 0=普通,1=联动,2=点动,3=循环,4=定时的模式设置(仅>8路模块支持) |

------

## 三、常用操控指令（16进制）

### 1. **读取输入状态**

```c
// 读通道1输入
发送: 01 04 00 00 00 01 31 CA
返回(未触发): 01 04 02 00 00 B9 30
返回(已触发): 01 04 02 00 01 78 F0
```

**批量读取1-3通道**

```c
发送: 01 04 00 00 00 03 B0 0B
返回: 01 04 06 00 01 00 01 00 00 0C 93
// 通道1=1(触发), 通道2=1, 通道3=0
```

### 2. **控制单路输出**

```c
// 开启通道1
发送: 01 05 00 00 FF 00 8C 3A

// 关闭通道1
发送: 01 05 00 00 00 00 CD CA
```

### 3. **设置模块参数（掉电保存，需重启）**

#### 3.1 **设置RS485站号（寄存器0x0032H）**

```c
// 设置站号为1
发送: 01 06 00 32 00 01 E9 C5
返回: 01 06 00 32 00 01 E9 C5

// 读取验证站号（功能码03）
发送: 01 03 00 32 00 01 25 C5
返回: 01 03 02 00 01 79 84  // 返回值为0x0001，表示站号为1

// 设置站号为2
发送: 01 06 00 32 00 02 A9 C4
返回: 01 06 00 32 00 02 A9 C4

// 读取验证站号
发送: 01 03 00 32 00 01 25 C5
返回: 01 03 02 00 02 39 85  // 返回值为0x0002，表示站号为2
```

**说明**：
- 寄存器地址：`0x0032H` (40051)
- 范围：1~255
- 修改后需重启模块才能生效
- 使用功能码06（写单个寄存器）进行设置
- 使用功能码03（读保持寄存器）进行验证

#### 3.2 **设置波特率（寄存器0x0033H）**

```c
// 设置为9600波特率（值=1）
发送: 01 06 00 33 00 01 B8 05
返回: 01 06 00 33 00 01 B8 05

// 读取验证波特率
发送: 01 03 00 33 00 01 74 05
返回: 01 03 02 00 01 79 84  // 返回值为0x0001，表示9600

// 设置为38400波特率（值=4，默认值）
发送: 01 06 00 33 00 04 78 06
返回: 01 06 00 33 00 04 78 06

// 读取验证波特率
发送: 01 03 00 33 00 01 74 05
返回: 01 03 02 00 04 B9 87  // 返回值为0x0004，表示38400

// 设置为115200波特率（值=7）
发送: 01 06 00 33 00 07 38 07
返回: 01 06 00 33 00 07 38 07

// 读取验证波特率
发送: 01 03 00 33 00 01 74 05
返回: 01 03 02 00 07 F9 86  // 返回值为0x0007，表示115200
```

**波特率值对应表**：
| 值 | 波特率 | 说明 |
|:---|:-------|:-----|
| 0  | 4800   |      |
| 1  | 9600   |      |
| 2  | 14400  |      |
| 3  | 19200  |      |
| 4  | 38400  | **默认值** |
| 5  | 56000  |      |
| 6  | 57600  |      |
| 7  | 115200 |      |

**说明**：
- 寄存器地址：`0x0033H` (40052)
- 修改后需重启模块才能生效
- **重要**：修改波特率后，需要立即将通信波特率切换到新值，否则无法继续通信
- 使用功能码06（写单个寄存器）进行设置
- 使用功能码03（读保持寄存器）进行验证

#### 3.3 **设置通讯检测时间（寄存器0x0030H，仅>8路模块支持）**

```c
// 设置通讯检测10秒断线关闭输出（值=100，单位：0.1秒）
发送: 01 06 00 30 00 64 88 2E
返回: 01 06 00 30 00 64 88 2E
```

**说明**：
- 寄存器地址：`0x0030H` (40049)
- 功能：检测时间 = N × 0.1秒
- 值=0：不检测通讯状态
- 值>0：检测通讯状态，当通讯断开N×0.1秒后，所有输出关闭
- **注意**：8路及以下模块不支持此功能

### 4. **批量控制多路输出**

#### 4.1 **全开/全关控制（寄存器0x0034H）**

```c
// 全开（所有通道同时开启）
发送: 01 06 00 34 00 01 89 C4
返回: 01 06 00 34 00 01 89 C4

// 全关（所有通道同时关闭）
发送: 01 06 00 34 00 00 C8 0A
返回: 01 06 00 34 00 00 C8 0A
```

**说明**：
- 寄存器地址：`0x0034H` (40053)
- 功能：`0`=全关，`1`=全开
- 使用功能码06（写单个寄存器）

#### 4.2 **按位控制通道1~16（寄存器0x0035H）**

```c
// 同时开启通道1、2、3（位0、位1、位2为1）
// 寄存器值 = 0x0007 (二进制: 0000 0000 0000 0111)
发送: 01 06 00 35 00 07 78 0A
返回: 01 06 00 35 00 07 78 0A

// 同时开启通道1-8（低8位全为1）
// 寄存器值 = 0x00FF (二进制: 0000 0000 1111 1111)
发送: 01 06 00 35 00 FF 38 0A
返回: 01 06 00 35 00 FF 38 0A

// 关闭通道1，保持其他通道状态不变
// 假设当前值为0x00FF，关闭通道1后应为0x00FE
// 寄存器值 = 0x00FE (二进制: 0000 0000 1111 1110)
发送: 01 06 00 35 00 FE F9 CA
返回: 01 06 00 35 00 FE F9 CA

// 全关（所有通道关闭）
// 寄存器值 = 0x0000
发送: 01 06 00 35 00 00 C9 CA
返回: 01 06 00 35 00 00 C9 CA
```

**说明**：
- 寄存器地址：`0x0035H` (40054)
- 功能：按位控制通道1~16
- 位映射：最低位（bit0）= 通道1，bit1 = 通道2，...，最高位（bit15）= 通道16
- 位值：`0`=关闭，`1`=开启
- 使用功能码06（写单个寄存器）
- **注意**：写入的值会**覆盖**所有通道状态，不是按位或/与操作

**示例：控制8路继电器模块**
```c
// 开启通道1-8（0x00FF = 1111 1111，低8位全为1）
01 06 00 35 00 FF 38 0A

// 关闭通道1，其他保持开启（0x00FE = 1111 1110）
01 06 00 35 00 FE F9 CA

// 关闭通道2，其他保持当前状态（0x00FC = 1111 1100）
01 06 00 35 00 FC FB CA

// 全关（0x0000）
01 06 00 35 00 00 C9 CA
```

#### 4.3 **按位控制通道17~32（寄存器0x0036H）**

```c
// 控制通道17-32，用法同0x0035H
// 位0=通道17，位1=通道18，...，位15=通道32
发送: 01 06 00 36 00 FF 69 CA
```

#### 4.4 **按位控制通道33~48（寄存器0x0037H）**

```c
// 控制通道33-48，用法同0x0035H
// 位0=通道33，位1=通道34，...，位15=通道48
发送: 01 06 00 37 00 FF 58 0A
```

------

## 四、关键限制

- **8路及以下模块**：不支持工作模式切换(仅普通模式)，不支持通讯检测功能
- **参数修改后需重启**才能生效
- **输出状态掉电不保存**，上电默认全关
