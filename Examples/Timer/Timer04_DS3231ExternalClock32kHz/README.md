# Timer04 - DS3231外部时钟32kHz示例

硬件定时器外部时钟计数功能演示案例，展示如何使用DS3231的32K引脚输出32kHz时钟作为TIM1定时器的外部时钟源。

**⚠️ 重要说明**：本案例使用TIM1（不是TIM2或TIM3），因为：
- TIM2已被TIM2_TimeBase模块占用（系统时间基准），不能用于外部时钟
- TIM3在STM32F103C8T6中没有ETR引脚
- 只有TIM1和TIM2有ETR引脚，TIM1的ETR引脚是PA12

---

## 🎯 TIM1的作用与外部时钟的关系

### 为什么外部时钟需要使用TIM1？

**核心概念**：外部时钟源（DS3231的32K输出）只是提供时钟信号，而TIM1定时器是**计数器**，用于接收、计数和测量这个外部时钟信号。

#### 1. **TIM1的作用**
- **计数器功能**：TIM1是一个16位硬件计数器，可以自动计数外部时钟的上升沿或下降沿
- **ETR引脚**：TIM1的ETR（External Trigger）引脚（PA12）专门用于接收外部时钟信号
- **自动计数**：一旦配置为外部时钟模式，TIM1会自动对每个外部时钟脉冲进行计数，无需CPU干预
- **溢出检测**：TIM1可以检测计数溢出（从ARR回到0），并产生中断或更新事件
- **高频计数**：TIM1可以处理高频时钟信号（如32kHz），远超CPU软件计数能力

#### 2. **外部时钟与TIM1的关系**
```
DS3231 32K输出（32kHz时钟）
    ↓
    ↓ 硬件连接（PA12）
    ↓
TIM1 ETR引脚（接收外部时钟信号）
    ↓
TIM1计数器（CNT寄存器自动计数）
    ↓
软件读取CNT值（观察计数效果）
```

**工作流程**：
1. **DS3231产生时钟信号**：32K引脚输出32kHz时钟（每秒32000个脉冲）
2. **TIM1接收时钟信号**：通过ETR引脚（PA12）接收外部时钟信号
3. **TIM1自动计数**：每个上升沿（或下降沿）触发CNT寄存器加1
4. **软件读取计数值**：通过读取TIM1->CNT寄存器，观察计数效果
5. **溢出检测**：当CNT从ARR（999）回到0时，检测溢出事件

#### 3. **为什么不能直接用外部时钟？**
- **外部时钟只是信号源**：DS3231的32K输出只是提供时钟脉冲，本身不是计数器
- **需要硬件计数器**：要测量时钟频率、计数脉冲数量，需要硬件计数器（TIM1）
- **CPU效率**：使用硬件计数器（TIM1）可以自动计数，无需CPU持续监控，节省CPU资源
- **精确测量**：硬件计数器可以精确捕获每个时钟脉冲，不受软件延迟影响
- **高频处理**：32kHz时钟频率较高，软件计数无法实时处理，必须使用硬件计数器

#### 4. **TIM1与内部时钟的区别**
| 特性 | 内部时钟（Timer02） | 外部时钟（Timer04） |
|------|-------------------|-------------------|
| **时钟源** | STM32内部系统时钟（72MHz） | DS3231外部时钟（32kHz） |
| **时钟精度** | 受系统时钟影响 | 受DS3231晶振精度影响（高精度） |
| **时钟稳定性** | 受温度、电压影响 | DS3231内部温度补偿，更稳定 |
| **应用场景** | 通用定时、PWM | 时间同步、频率测量、精确计时 |
| **计数器** | TIM3（内部时钟） | TIM1（外部时钟，通过ETR） |
| **计数频率** | 可达MHz级别 | 受外部时钟限制（32kHz） |

#### 5. **TIM1 ETR引脚的特殊性**
- **专用外部时钟输入**：ETR引脚是专门设计用于接收外部时钟信号的
- **硬件滤波**：ETR引脚支持硬件滤波，可以过滤噪声
- **极性选择**：可以配置为上升沿或下降沿触发
- **预分频**：ETR支持预分频，可以降低输入时钟频率
- **高频支持**：ETR引脚可以处理高频时钟信号（如32kHz）

#### 6. **32kHz外部时钟的优势**
- **高精度**：DS3231的32kHz输出精度高，受温度补偿
- **稳定性**：不受STM32系统时钟影响，独立运行
- **时间同步**：可以与DS3231的RTC时间同步，实现精确计时
- **频率测量**：可以用于测量其他信号的频率
- **实时性**：硬件计数器可以实时处理高频信号，无需CPU干预

**总结**：TIM1定时器是**计数器**，用于接收和计数外部时钟信号。外部时钟源（DS3231）只是提供时钟脉冲，而TIM1负责计数、测量和产生溢出事件。两者配合使用，可以实现高精度的外部时钟计数功能，特别适合需要高精度、高稳定性的应用场景。

---

## 📋 案例目的

- **核心目标**：演示使用DS3231的32kHz输出作为定时器外部时钟源的方法
- **学习重点**：
  - DS3231 32kHz输出的使能方法（DS3231_Enable32kHz）
  - 定时器外部时钟源的配置（TIM_ETRClockMode2Config）
  - ETR引脚的使用和配置
  - 外部时钟与内部时钟的区别
  - 高频外部时钟驱动的计数效果
  - **TIM1定时器的作用**：理解TIM1作为计数器，用于接收和计数外部时钟信号
  - **外部时钟与TIM1的关系**：理解为什么外部时钟需要使用TIM1定时器
- **应用场景**：适用于需要高精度外部时钟源、高频计数、频率测量等场景

---

## 🔧 硬件要求

### 必需外设

- **DS3231实时时钟模块**（I2C接口）：
  - SCL连接到PB10（软件I2C2）
  - SDA连接到PB11（软件I2C2）
  - **32K引脚连接到PA12（TIM1的ETR引脚）**
  - VCC连接到3.3V
  - GND连接到GND
  - **⚠️ 重要提示**：I2C总线需要上拉电阻（4.7kΩ-10kΩ）连接到SCL和SDA

- **OLED显示屏**（SSD1306，I2C接口）：
  - SCL连接到PB8（软件I2C1）
  - SDA连接到PB9（软件I2C1）
  - VCC连接到3.3V
  - GND连接到GND
  - **⚠️ 重要提示**：OLED需要外部上拉电阻（通常4.7kΩ-10kΩ）连接到SCL和SDA

- **USART1串口**（用于UART日志输出）：
  - TX连接到PA9
  - RX连接到PA10
  - 波特率：115200，8N1格式
  - **⚠️ 重要提示**：串口助手需要配置为GB2312编码以正确显示中文

### 硬件连接

**DS3231连接**：
- DS3231 SCL → PB10
- DS3231 SDA → PB11
- DS3231 32K → PA12（TIM1 ETR引脚）
- DS3231 VCC → 3.3V
- DS3231 GND → GND
- **⚠️ 重要**：SCL和SDA需要上拉电阻（4.7kΩ-10kΩ）到3.3V
- **⚠️ 注意**：32K引脚是推挽输出，不需要上拉电阻，直接连接即可

**OLED连接**：
- OLED SCL → PB8
- OLED SDA → PB9
- OLED VCC → 3.3V
- OLED GND → GND
- **⚠️ 重要**：SCL和SDA需要上拉电阻（4.7kΩ-10kΩ）到3.3V

**UART连接**：
- USART1 TX (PA9) → USB转串口模块RX
- USART1 RX (PA10) → USB转串口模块TX
- GND → GND

### DS3231引脚元件接入说明

**DS3231引脚详细说明和元件接入要求**：

#### 1. **电源引脚（VCC和GND）**
- **VCC**：连接到3.3V电源
  - 建议在VCC和GND之间添加**100nF去耦电容**（靠近DS3231模块）
  - 如果电源线较长，建议添加**10μF电解电容**作为储能电容
- **GND**：连接到STM32的GND
  - 确保共地连接，避免地电位差

#### 2. **I2C通信引脚（SCL和SDA）**
- **SCL（PB10）**：I2C时钟线
  - **必须添加上拉电阻**：4.7kΩ-10kΩ连接到3.3V
  - 上拉电阻一端接SCL，另一端接3.3V
  - 如果多个I2C设备共享总线，只需一组上拉电阻
- **SDA（PB11）**：I2C数据线
  - **必须添加上拉电阻**：4.7kΩ-10kΩ连接到3.3V
  - 上拉电阻一端接SDA，另一端接3.3V
  - 如果多个I2C设备共享总线，只需一组上拉电阻
- **⚠️ 重要**：I2C总线是开漏输出，必须添加上拉电阻，否则无法正常工作
- **推荐值**：4.7kΩ（标准模式）或2.2kΩ（快速模式）

#### 3. **32kHz时钟输出引脚（32K）**
- **32K（PA12）**：32kHz时钟输出引脚
  - **输出类型**：推挽输出（Push-Pull）
  - **不需要上拉电阻**：因为DS3231的32K输出是推挽输出，可以直接驱动负载
  - **连接方式**：直接连接到STM32的PA12（TIM1的ETR引脚），无需任何外部元件
  - **输出频率**：32kHz（固定频率，不可配置）
  - **信号电平**：0V（低电平）和3.3V（高电平）
  - **信号特性**：连续方波输出，占空比约50%
  - **驱动能力**：推挽输出，可以直接驱动CMOS输入（如STM32的ETR引脚）
  - **⚠️ 重要**：32K引脚不需要上拉电阻、下拉电阻或限流电阻，直接连接即可
  - **注意**：32K引脚是专用时钟输出，与SQW引脚不同（SQW可配置频率，32K固定32kHz）

#### 4. **方波输出引脚（SQW/INT）**
- **SQW/INT**：方波输出/中断输出引脚（本案例不使用）
  - **输出类型**：推挽输出
  - **不需要上拉电阻**
  - **注意**：本案例不使用此引脚，Timer03案例使用

#### 5. **备用电池引脚（VBAT）**
- **VBAT**：备用电池输入引脚（可选）
  - **功能**：当主电源断开时，备用电池保持RTC运行
  - **电压范围**：2.3V-5.5V
  - **推荐**：3V纽扣电池（CR2032）
  - **连接**：如果使用备用电池，连接到VBAT引脚
  - **注意**：不使用备用电池时，VBAT可以悬空或连接到GND

#### 6. **温度补偿引脚（TEMP）**
- **TEMP**：温度传感器输出（本案例不使用）
  - **功能**：内部温度传感器，用于温度补偿
  - **注意**：本案例不使用此引脚

**DS3231典型电路连接示意图**：
```
                    DS3231模块
    ┌─────────────────────────────────────┐
    │  VCC ────┬─── 3.3V                  │
    │         │                           │
    │         └─── 100nF ──── GND        │
    │                                    │
    │  SCL ────┬─── PB10 (STM32)        │
    │         │                           │
    │         └─── 4.7kΩ ──── 3.3V      │ ← 上拉电阻
    │                                    │
    │  SDA ────┬─── PB11 (STM32)        │
    │         │                           │
    │         └─── 4.7kΩ ──── 3.3V      │ ← 上拉电阻
    │                                    │
    │  32K ────┬─── PA12 (TIM1_ETR)     │
    │         │                           │
    │         └─── (无需上拉电阻)        │
    │                                    │
    │  GND ────┬─── GND (STM32)         │
    │                                    │
    │  VBAT ──── (可选，3V电池)          │
    └─────────────────────────────────────┘
```

**元件清单**：
- **上拉电阻**：2个（SCL和SDA各一个）
  - 阻值：4.7kΩ-10kΩ（推荐4.7kΩ）
  - 功率：1/8W或1/4W
  - 精度：5%或1%
  - **位置**：SCL和SDA各一个，连接到3.3V
- **32K引脚连接**：**无需任何电阻**
  - **⚠️ 重要**：32K引脚是推挽输出，直接连接到PA12即可
  - **不需要**：上拉电阻、下拉电阻、限流电阻
  - **连接方式**：DS3231 32K引脚 → 直接连接到STM32 PA12（TIM1_ETR）
- **去耦电容**：1个（可选但推荐）
  - 容值：100nF（0.1μF）
  - 类型：陶瓷电容
  - 位置：靠近DS3231的VCC和GND引脚
- **储能电容**：1个（可选，电源线较长时推荐）
  - 容值：10μF
  - 类型：电解电容或钽电容
  - 位置：靠近DS3231的VCC和GND引脚

### 硬件配置

**⚠️ 重要说明**：案例是独立工程，硬件配置在案例目录下的 `board.h` 中。
如果硬件引脚不同，直接修改 `Examples/Timer/Timer04_DS3231ExternalClock32kHz/board.h` 中的配置即可。

**DS3231 I2C配置**：
```c
#define SOFT_I2C_CONFIGS { \
    {GPIOB, GPIO_Pin_10, GPIOB, GPIO_Pin_11, 5, 1}, /* SoftI2C2：PB10(SCL), PB11(SDA)，DS3231使用 */ \
}
```

**OLED I2C配置**：
```c
#define OLED_I2C_CONFIG { \
    GPIOB, GPIO_Pin_8, /* SCL: PB8 */ \
    GPIOB, GPIO_Pin_9, /* SDA: PB9 */ \
}
```

**⚠️ ETR引脚说明**：
- **TIM1的ETR引脚是PA12**（STM32F103C8T6）
- **TIM2的ETR引脚是PA0**（但TIM2已被TIM2_TimeBase模块占用，不能使用）
- **TIM3在STM32F103C8T6中没有ETR引脚**
- DS3231的32K引脚需要连接到PA12
- **重要**：代码中已自动配置PA12为输入模式（TIM1_ETR），无需手动配置GPIO
- **⚠️ 警告**：TIM2已被TIM2_TimeBase模块占用（系统时间基准），不能用于外部时钟！

---

## 📦 模块依赖

- **DS3231模块**：DS3231实时时钟驱动（32kHz输出使能）
- **软件I2C模块**：DS3231和OLED使用软件I2C接口
- **TIM2_TimeBase模块**：时间基准（用于获取系统tick，控制显示更新频率）
  - **⚠️ 注意**：TIM2已被此模块占用，不能用于外部时钟
- **GPIO模块**：用于配置UART、OLED、DS3231的GPIO引脚
- **UART模块**：用于串口日志输出
- **Debug模块**：用于UART输出功能（printf重定向）
- **Log模块**：用于分级日志输出
- **ErrorHandler模块**：用于错误处理
- **OLED模块**：用于显示计数值
- **延时模块**：用于降低CPU占用率
- **系统初始化模块**：用于初始化系统基础功能

---

## 🔄 实现流程

### 整体逻辑

1. **系统初始化阶段**：
   - 调用 `System_Init()` 初始化系统基础功能
   - 初始化UART（USART1）
   - 初始化Debug模块（UART模式）
   - 初始化Log模块
   - 初始化ErrorHandler模块
   - 初始化OLED显示屏

2. **DS3231初始化阶段**：
   - 初始化软件I2C2（PB10/11，用于DS3231）
   - 初始化DS3231模块
   - 使能DS3231的32kHz输出（DS3231_Enable32kHz）

3. **TIM1外部时钟配置阶段**：
   - 使能GPIOA和AFIO时钟（用于ETR引脚复用功能）
   - 配置PA12为浮空输入（TIM1_ETR功能）
   - 使能TIM1时钟（APB2外设）
   - 先禁用TIM1（如果已启动）
   - 配置TIM1时间基准（PSC=0, ARR=999）
   - 配置TIM1使用ETR作为外部时钟源（TIM_ETRClockMode2Config）
   - 清零计数器
   - 启动TIM1定时器

4. **主循环阶段**：
   - 循环读取TIM1->CNT寄存器值
   - OLED显示计数值、溢出次数、运行时间
   - UART输出详细日志
   - 延时降低CPU占用率

### 关键方法

1. **DS3231 32kHz输出使能**：使用 `DS3231_Enable32kHz()` 使能32kHz输出
2. **TIM1外部时钟配置**：使用 `TIM_ETRClockMode2Config()` 配置ETR外部时钟模式2
3. **外部时钟驱动**：DS3231的32K输出32kHz时钟，通过ETR引脚驱动TIM1计数
4. **计数效果**：TIM1每接收到一个上升沿，CNT寄存器加1，每31.25ms完成一次0-999计数循环
5. **溢出检测**：通过比较当前值和上次值，检测溢出事件（从999回到0）
6. **溢出时间**：ARR=999时，每31.25ms溢出一次（0→1→2→...→999→0，共1000个上升沿）

### TIM1定时器的作用说明

**TIM1的核心作用**：
- **硬件计数器**：TIM1是一个16位硬件计数器，可以自动计数外部时钟脉冲
- **ETR引脚接收**：通过ETR引脚（PA12）接收DS3231的32K输出（32kHz时钟）
- **自动计数**：每个外部时钟上升沿触发CNT寄存器自动加1，无需CPU干预
- **溢出检测**：当CNT从ARR（999）回到0时，可以检测溢出事件
- **高频处理**：TIM1可以处理高频时钟信号（32kHz），远超CPU软件计数能力

**为什么需要TIM1**：
- DS3231的32K输出只是提供时钟信号（32kHz时钟），本身不是计数器
- 要测量时钟频率、计数脉冲数量，需要硬件计数器（TIM1）
- 使用硬件计数器可以自动计数，节省CPU资源，提高系统效率
- 硬件计数器可以精确捕获每个时钟脉冲，不受软件延迟影响
- 32kHz时钟频率较高，软件计数无法实时处理，必须使用硬件计数器

---

## 📚 关键函数说明

### DS3231相关函数

- **`DS3231_Init()`**：初始化DS3231模块
  - 在本案例中用于初始化DS3231，准备配置32kHz输出
  - 使用软件I2C接口（SoftI2C2，PB10/11）

- **`DS3231_Enable32kHz()`**：使能DS3231的32kHz输出
  - 在本案例中用于使能32kHz输出
  - 32K引脚输出32kHz时钟信号

**详细函数实现和调用示例请参考**：`main_example.c` 中的代码

### TIM1外部时钟相关函数

- **`TIM1_ExternalClock_Init()`**：初始化TIM1外部时钟（ETR模式）
  - 在本案例中用于配置TIM1使用ETR引脚（PA12）作为外部时钟源
  - 自动配置PA12为浮空输入（TIM1_ETR）
  - 使用 `TIM_ETRClockMode2Config()` 配置外部时钟模式2
  - ETR引脚接收DS3231的32K输出（32kHz时钟）
  - **⚠️ 注意**：TIM2已被TIM2_TimeBase模块占用，不能用于外部时钟

- **`TIM_ETRClockMode2Config()`**：配置定时器外部时钟模式2
  - 在本案例中用于配置TIM1使用ETR作为外部时钟源
  - 参数：预分频器（OFF）、极性（上升沿有效）、滤波（0）

- **`TIM1_GetCount()`**：读取TIM1当前计数值
  - 在本案例中用于读取TIM1->CNT寄存器值
  - 返回值：0-999（循环计数，ARR=999）
  - 检测溢出事件，更新溢出计数器
  - **溢出时间**：每31.25ms溢出一次（0→1→2→...→999→0）

**详细函数实现和调用示例请参考**：`main_example.c` 中的代码

### OLED相关函数

- **`OLED_Init()`**：初始化OLED显示屏
  - 在本案例中用于初始化OLED，准备显示计数值

- **`OLED_ShowString()`**：在OLED上显示字符串
  - 在本案例中用于显示标题和状态文本

- **`OLED_ShowNum()`**：在OLED上显示数字
  - 在本案例中用于显示TIM1计数值、溢出次数、运行时间

### UART和日志相关函数

- **`UART_Init()`**：初始化UART模块
  - 在本案例中用于初始化USART1，准备串口输出

- **`Debug_Init()`**：初始化Debug模块（UART模式）
  - 在本案例中用于实现printf重定向到UART

- **`Log_Init()`**：初始化Log模块
  - 在本案例中用于初始化分级日志系统

- **`LOG_INFO()`**：输出INFO级别日志
  - 在本案例中用于输出详细日志信息（中文，GB2312编码）

**详细函数实现和调用示例请参考**：`main_example.c` 中的代码

---

## ⚠️ 注意事项与重点

### ⚠️ 重要提示

1. **ETR引脚映射**：
   - **TIM1的ETR引脚是PA12**（STM32F103C8T6）
   - **TIM2的ETR引脚是PA0**（但TIM2已被TIM2_TimeBase模块占用，不能使用）
   - **TIM3在STM32F103C8T6中没有ETR引脚**
   - DS3231的32K引脚必须正确连接到PA12
   - **重要**：代码中已自动配置PA12为输入模式，无需手动配置GPIO
   - **⚠️ 警告**：TIM2已被TIM2_TimeBase模块占用（系统时间基准），不能用于外部时钟！

2. **DS3231初始化顺序**：
   - 必须先初始化DS3231并使能32kHz输出
   - 然后再配置TIM1外部时钟
   - 确保DS3231的32K输出已稳定后再启动TIM1

3. **外部时钟频率**：
   - 本案例使用32kHz时钟（每秒32000个上升沿）
   - TIM1每接收到一个上升沿，CNT寄存器加1
   - 每31.25ms完成一次0-999计数循环（溢出）

4. **计数速度和溢出时间**：
   - 外部时钟频率：32kHz（很快，每秒计数32000次）
   - ARR=999：CNT从0到999，需要1000个上升沿
   - 溢出时间：31.25ms（每31.25ms OVF增加1）
   - 与内部时钟（72MHz）相比，外部时钟频率较低但更稳定
   - 适合高频计数和时间同步应用

5. **硬件连接**：
   - DS3231的32K引脚必须连接到TIM1的ETR引脚（PA12）
   - I2C总线必须添加上拉电阻（4.7kΩ-10kΩ）
   - 32K引脚是推挽输出，不需要上拉电阻
   - 确保连接正确，否则TIM1无法接收外部时钟

### 🔑 关键点

1. **外部时钟源配置**：使用 `TIM_ETRClockMode2Config()` 配置ETR外部时钟模式2
2. **DS3231 32kHz输出**：使用 `DS3231_Enable32kHz()` 使能32kHz输出
3. **时钟源切换**：从内部时钟切换到外部时钟，需要重新配置定时器
4. **计数效果**：外部时钟驱动的计数速度取决于外部时钟频率（32kHz）
5. **定时器选择**：必须使用TIM1（TIM2已被占用，TIM3没有ETR引脚）

### 💡 调试技巧

1. **TIM1不计数**：
   - 检查DS3231是否已初始化并使能32kHz输出
   - 检查DS3231的32K引脚是否连接到PA12（TIM1的ETR引脚）
   - **检查32K引脚连接**：确认32K引脚直接连接到PA12，没有添加任何电阻
   - 检查PA12是否已正确配置为输入模式（代码中已自动配置）
   - 检查TIM1的ETR配置是否正确（ECE位应为1）
   - 使用示波器检查DS3231的32K输出是否正常（32kHz时钟，连续方波）
   - 使用示波器检查PA12引脚是否有信号输入（32kHz方波）
   - 检查TIM1的SMCR寄存器，确认ECE=1

2. **计数值不变化**：
   - 检查DS3231 32kHz输出是否已使能
   - 检查硬件连接是否正确（32K -> PA12，直接连接，无电阻）
   - **检查32K引脚**：确认32K引脚没有添加上拉电阻（推挽输出不需要）
   - 检查TIM1是否已启动（CR1的CEN位应为1）
   - 使用示波器检查ETR引脚（PA12）是否有信号（32kHz方波）
   - 检查TIM1是否被其他模块占用

3. **DS3231初始化失败**：
   - 检查I2C连接是否正确（SCL接PB10，SDA接PB11）
   - 检查I2C上拉电阻是否正确连接（4.7kΩ-10kΩ）
   - 检查DS3231电源连接是否正确（3.3V）
   - 使用I2C扫描工具检查DS3231地址（0x68）

4. **OLED不显示**：
   - 检查OLED连接是否正确（SCL接PB8，SDA接PB9）
   - 检查I2C上拉电阻是否正确连接
   - 检查软件I2C配置是否正确

---

## 🔍 扩展练习

1. **对比不同时钟源**：同时运行Timer02（内部时钟）、Timer03（1Hz方波）、Timer04（32kHz），对比计数速度差异
2. **频率测量**：使用外部时钟测量其他信号的频率
3. **时间同步**：使用DS3231的精确时钟同步系统时间
4. **多定时器外部时钟**：使用DS3231的32kHz输出驱动多个定时器
5. **预分频器实验**：尝试使用TIM1的预分频器（PSC）降低计数速度

---

## 📚 相关模块

- **DS3231模块**：`Drivers/sensors/ds3231.c/h` - DS3231实时时钟驱动
- **TIM2_TimeBase模块**：`Drivers/timer/TIM2_TimeBase.c/h` - 时间基准模块
- **GPIO驱动**：`Drivers/basic/gpio.c/h` - GPIO配置
- **UART驱动**：`Drivers/uart/uart.c/h` - UART通信
- **Debug模块**：`Debug/debug.c/h` - Debug输出功能
- **Log模块**：`Debug/log.c/h` - 分级日志系统
- **ErrorHandler模块**：`Common/error_handler.c/h` - 错误处理框架
- **OLED驱动**：`Drivers/display/oled_ssd1306.c/h` - OLED显示
- **软件I2C驱动**：`Drivers/i2c/i2c_sw.c/h` - 软件I2C接口
- **延时功能**：`System/delay.c/h` - 延时服务
- **系统初始化**：`System/system_init.c/h` - 系统初始化框架
- **硬件配置**：案例目录下的 `board.h`
- **模块配置**：案例目录下的 `config.h`
- **主程序**：案例目录下的 `main_example.c`

---

---

## 📊 技术参数

### TIM1配置参数
- **定时器**：TIM1（高级定时器）
- **ETR引脚**：PA12
- **外部时钟频率**：32kHz（DS3231 32K输出）
- **预分频器（PSC）**：0（不分频）
- **自动重装载值（ARR）**：999
- **计数范围**：0-999
- **计数速度**：每秒计数32000次
- **溢出时间**：每31.25ms溢出一次（OVF增加1）

### DS3231配置参数
- **I2C地址**：0x68（7位地址）
- **32kHz输出**：已使能（通过DS3231_Enable32kHz）
- **32kHz输出引脚**：32K
- **32kHz输出类型**：推挽输出（不需要上拉电阻）

---

**最后更新**：2024-01-01
