# Flash08 程序状态记录

## 当前功能状态（2024年）

### 核心功能
1. ✅ SD卡初始化与检测（支持插拔卡检测）
2. ✅ MBR分区表创建（单分区方案）
3. ✅ FAT32分区格式化
4. ✅ 文件系统挂载与卸载
5. ✅ 文件操作（创建、读取、写入、追加、重命名、删除）
6. ✅ 目录操作（创建、删除）
7. ✅ STM32直接访问区测试（100MB，扇区2048-206847）
8. ✅ 插拔卡检测与自动重新挂载
9. ✅ MBR分区表清除功能

### 分区布局
- **扇区0**: MBR
- **扇区1-2047**: 保留区（约1MB）
- **扇区2048-206847**: STM32直接访问区（100MB）
- **扇区206848-结束**: FAT32分区

### 配置状态
- **调试模式**: 关闭
  - `FATFS_DETAILED_DEBUG = 0`
  - `TF_SPI_DEBUG_ENABLED = 0`
  - `LOG_LEVEL = INFO`
- **强制格式化**: 关闭（`FATFS_FORCE_FORMAT = 0`）

### 程序流程
1. 系统初始化
2. UART/Debug/Log初始化
3. LED/OLED初始化
4. SPI初始化
5. SD卡检测与初始化
6. 文件系统挂载（如未格式化则自动格式化）
7. 测试环节：
   - 文件夹测试
   - 文件测试
   - 重命名测试
   - 删除测试
   - STM32直接操作区边界测试
8. 循环运行（300次，约30秒，测试插拔卡检测）
9. 倒计时5秒
10. 清除MBR分区表
11. 程序结束

### 已验证功能
- ✅ 格式化8GB SD卡成功
- ✅ 文件系统信息显示正确（7578 MB）
- ✅ 所有文件操作测试通过
- ✅ 插拔卡检测正常工作
- ✅ MBR分区表清除成功


