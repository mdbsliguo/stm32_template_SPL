# Core - 应用层

应用层，包含主程序入口、中断处理和系统配置文件。

---

## 📋 目录说明

```
Core/
├── main.c                 # 主程序入口
├── stm32f10x_conf.h       # SPL库配置文件
├── stm32f10x_it.c         # 中断服务函数实现
└── stm32f10x_it.h         # 中断服务函数声明
```

---

## 🎯 职责

1. **主程序入口**：系统初始化，主循环逻辑，应用层业务代码
2. **中断处理**：中断服务函数实现，中断回调处理，中断优先级管理
   - **ISR实现位置**：`stm32f10x_it.c` - 所有外设的ISR统一在此实现
   - **实现原则**：ISR中统一调用驱动层的处理函数，保持简洁
   - **职责划分**：
     - Core层：实现所有ISR（中断向量表对应的函数）
     - 驱动层：提供`XXX_IRQHandler()`处理函数
     - 案例层：只需要写回调函数，通过模块API注册
   - **EXTI ISR实现示例**：
     - 独立中断向量（EXTI0-4）：直接调用`EXTI_IRQHandler(EXTI_LINE_X)`
     - 共享中断向量（EXTI5-9、EXTI10-15）：检查所有可能的线，然后调用对应的处理函数
     - 特殊功能中断（EXTI16-19）：PVD、RTC Alarm、USB Wakeup、Ethernet Wakeup
   - **详细规范**：参考`PROJECT_KEYWORDS.md`中的"中断服务程序（ISR）实现规范"章节
3. **系统配置**：SPL库功能开关，系统级宏定义

---

## 📝 文件说明

| 文件 | 说明 |
|------|------|
| `main.c` | 主程序入口文件，系统启动后首先执行，包含系统初始化和主循环 |
| `stm32f10x_conf.h` | SPL库配置文件，控制哪些外设库被编译 |
| `stm32f10x_it.c/h` | 中断服务函数实现文件，包含所有中断服务函数 |

---

## ⚠️ 重要说明

1. **不要在main()中直接操作硬件**
   - ❌ 错误：`GPIO_SetBits(GPIOA, GPIO_Pin_1);`
   - ✅ 正确：通过驱动模块 `LED_On(LED_1);`

2. **中断服务函数要尽可能短**
   - 快速处理，设置标志位
   - 复杂处理放到主循环

3. **避免在中断中调用阻塞函数**
   - ❌ 错误：`Delay_ms(100);`（在中断中，应使用非阻塞延时）
   - ✅ 正确：设置标志，主循环处理

4. **保持中断服务函数的可重入性**
   - 注意共享资源的保护
   - 使用临界区保护（如需要）

5. **System_Init()必须在main()开始调用**
   - 其他模块依赖系统初始化
   - 不要跳过系统初始化

---

## 📚 详细文档

- **使用示例**：[Examples/](../Examples/) - 演示案例

---

## 🔗 相关模块

- **系统初始化**：`System/system_init.c/h` - 系统初始化框架
- **错误处理**：`Common/error_handler.c/h` - 统一错误处理
- **日志系统**：`Debug/log.c/h` - 日志系统

---

**最后更新**：2024-01-01
