# system - 系统服务层

系统服务层，提供系统级功能和服务，包括系统初始化、延时、时钟管理等。

---

## 📋 目录说明

```text
System/
├── system_init.c/h      # 系统初始化框架（统一入口）
├── delay.c/h            # 延时函数接口
├── clock_manager.c/h    # 时钟管理（动态频率调节）
├── iwdg.c/h             # 独立看门狗管理
├── module_controller.c/h # 模块开关总控
├── system_monitor.c/h   # 系统监控模块
└── config.h             # 系统配置管理
```

---

## 🎯 职责

1. **系统初始化框架**：统一的系统初始化入口，按顺序初始化各个模块，初始化状态管理
2. **延时服务**：微秒/毫秒级精确延时，动态时钟适配，溢出保护
3. **时钟管理**：动态频率调节（DVFS），多档位频率支持（8~72MHz），负载检测与自适应
4. **看门狗管理**：独立看门狗（IWDG）初始化与配置，自动超时时间计算，喂狗接口
5. **模块开关总控**：统一的模块状态查询接口，编译时/运行时模块状态管理，模块依赖关系检查
6. **系统监控**：CPU使用率监控，内存使用监控（堆、栈），错误统计，异常记录，温度传感器，运行时间统计，健康检查

---

## 📝 功能列表

| 模块 | 主要功能 | 状态 |
|------|----------|------|
| system_init | 统一系统初始化入口，按顺序初始化模块，初始化状态管理 | ✅ 已实现 |
| delay | 阻塞式/非阻塞式延时，微秒/毫秒级精确延时，动态时钟适配 | ✅ 已测试 |
| clock_manager | 时钟管理，DVFS自动调频，9档位（8MHz~72MHz），负载检测 | ✅ 已测试 |
| iwdg | 独立看门狗管理，自动超时时间计算，喂狗接口，系统保护 | ✅ 已实现 |
| module_controller | 模块开关总控，模块状态查询，依赖检查，初始化顺序管理 | ✅ 已实现 |
| system_monitor | CPU/内存监控，错误统计，异常记录，温度传感器，健康检查 | ✅ 已调试完成 |

---

## ⚠️ 重要说明

1. **System_Init()必须在main()开始调用**
   - 其他模块依赖系统初始化
   - 不要跳过系统初始化

2. **延时函数是阻塞式的**
   - 执行期间CPU不处理其他任务
   - 实时性要求高的场景慎用

3. **时钟切换需要时间**
   - 切换频率时有锁定时间
   - 频繁切换可能影响性能

4. **SysTick被延时模块占用**
   - 如果使用RTOS，需要协调SysTick使用
   - 注意SysTick中断优先级

5. **看门狗注意事项**
   - 一旦启用看门狗，只能通过系统复位禁用
   - 必须在超时时间内定期调用`IWDG_Refresh()`，否则系统会复位
   - 超时时间范围：1ms ~ 32768ms

---

## 📚 详细文档

- **配置教程**：[Docs/CONFIG_TUTORIAL.md](../Docs/CONFIG_TUTORIAL.md) - 所有模块的使用配置说明
- **使用示例**：[Examples/](../Examples/) - 演示案例

---

## 🔗 相关模块

- **硬件配置**：`BSP/board.h` - 时钟配置参数
- **错误处理**：`Common/error_handler.c/h` - 统一错误处理
- **调试工具**：`Debug/log.c/h` - 日志系统

---

**最后更新**：2024-01-01
