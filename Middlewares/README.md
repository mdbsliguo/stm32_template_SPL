# middlewares - 中间件层

中间件层，提供协议栈、算法库、存储管理等高级功能，位于驱动层和应用层之间。

---

## 📋 目录说明

```
middlewares/
├── protocols/      # 协议栈（计划中）
├── algorithms/     # 算法库（计划中）
└── storage/        # 存储管理（计划中）
```

---

## 🎯 职责

1. **协议栈**：通信协议实现（Modbus、1-Wire等），协议解析与封装，协议适配层
2. **算法库**：软件滤波器，CRC校验，数学工具函数
3. **存储管理**：配置参数管理，数据存储抽象，备份与恢复

---

## 📝 计划实现的模块

### 协议栈 (`protocols/`)

| 模块 | 功能 | 状态 |
|------|------|------|
| modbus | Modbus RTU协议栈 | ⏳ 计划中 |
| onewire | 1-Wire协议 | ⏳ 计划中 |
| canopen | CANopen协议栈 | ⏳ 计划中 |
| dmx512 | DMX512协议 | ⏳ 计划中 |

### 算法库 (`algorithms/`)

| 模块 | 功能 | 状态 |
|------|------|------|
| filter | 软件滤波器（低通/高通/卡尔曼） | ⏳ 计划中 |
| crc | CRC校验（硬件/软件） | ⏳ 计划中 |
| math_utils | 数学工具函数 | ⏳ 计划中 |
| soft_timer | 软件定时器，多定时器管理，单次/循环模式 | ⏳ 计划中 |

### 存储管理 (`storage/`)

| 模块 | 功能 | 状态 |
|------|------|------|
| config_manager | 配置参数管理 | ⏳ 计划中 |
| nvram | 非易失性存储抽象 | ⏳ 计划中 |

---

## 📚 设计原则

1. **独立于硬件**：中间件层不直接访问硬件，通过驱动层接口访问
2. **可移植性**：中间件代码应尽可能独立，便于跨平台移植
3. **可配置性**：支持编译时和运行时配置
4. **模块化设计**：每个中间件模块独立，低耦合高内聚

---

## ⚠️ 重要说明

1. **不要直接访问硬件**
   - ❌ 错误：直接操作GPIO寄存器
   - ✅ 正确：通过驱动层接口

2. **保持模块独立性**
   - 避免模块间直接依赖
   - 通过接口交互

3. **注意资源占用**
   - 中间件可能占用较多RAM/Flash
   - 按需启用模块

---

## 🔗 相关模块

- **驱动层**：`Drivers/` - 硬件访问（按类型分类：basic/i2c/spi/display/sensors等）
- **系统服务**：`system/` - 系统级功能
- **公共模块**：`common/` - 通用工具

---

**最后更新**：2024-01-01
