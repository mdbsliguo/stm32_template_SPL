# Debug - 调试工具层

调试工具层，提供调试输出、分级日志、断言等功能，支持调试/发布模式切换。

---

## 📋 目录说明

```
Debug/
├── debug.c/h        # 调试输出（printf重定向）
├── log.c/h          # 分级日志系统
└── assert.c/h       # 断言系统
```

---

## 🎯 职责

1. **调试输出**：printf重定向到UART/SWO，字符输出接口，输出模式配置
2. **分级日志**：DEBUG/INFO/WARN/ERROR级别，模块名显示，时间戳支持（基于TIM2_TimeBase）
3. **断言系统**：断言宏定义，调试/发布模式切换，断言失败处理

---

## 📝 功能列表

| 模块 | 主要功能 | 特性 | 状态 |
|------|----------|------|------|
| debug | 调试输出，printf重定向 | 支持UART/SWO输出模式，字符输出函数 | ✅ 已实现 |
| log | 分级日志系统 | 四级日志（DEBUG/INFO/WARN/ERROR），日志级别控制，模块名显示，时间戳支持，颜色输出，统一错误码系统，配置管理 | ✅ 已实现 |
| assert | 断言系统 | 断言宏（ASSERT/ASSERT_MSG），调试/发布模式切换，断言失败处理 | ✅ 已实现 |

---

## ⚠️ 重要说明

1. **串口输出规范** `[案例]` `[P1]`
   - 串口输出详细日志，支持中文（GB2312编码）
   - 使用Log模块的分级输出（LOG_DEBUG/LOG_INFO/LOG_WARN/LOG_ERROR）
   - 详见[AI规则体系](../../AI/README.md)

2. **日志输出是阻塞式的**
   - 输出期间会占用CPU时间
   - 实时性要求高的场景慎用

2. **断言只在调试模式有效**
   - 发布版本中断言被禁用
   - 不要依赖断言进行错误处理

3. **日志级别影响性能**
   - DEBUG级别会产生大量日志
   - 发布版本建议使用ERROR级别或禁用

4. **调试输出需要硬件支持**
   - UART模式需要配置UART外设
   - SWO模式需要SWO硬件支持

5. **日志模块依赖关系**
   - 日志模块依赖 `debug` 模块（用于字符输出）
   - 时间戳功能依赖 `TIM2_TimeBase` 模块（可选）
   - 错误处理依赖 `error_handler` 模块（可选）

6. **缓冲区限制**
   - 单条日志最大256字节（包括前缀和内容）
   - 超过限制的日志会被截断，并记录缓冲区溢出错误

7. **循环依赖**
   - 日志模块可以记录错误处理模块的错误
   - 但日志模块自身的错误不会通过日志输出（避免循环）

---

## 📚 详细文档

- **配置教程**：[Docs/CONFIG_TUTORIAL.md](../Docs/CONFIG_TUTORIAL.md) - 所有模块的使用配置说明
- **使用示例**：[Examples/](../Examples/) - 演示案例

---

## 🔗 相关模块

- **系统初始化**：`system/system_init.c/h` - 系统初始化
- **错误处理**：`common/error_handler.c/h` - 统一错误处理
- **硬件配置**：`BSP/board.h` - 硬件配置

---

**最后更新**：2024-01-01
